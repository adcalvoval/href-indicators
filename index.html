<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>HREF Indicators Analysis Tool</title>

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üåç</text></svg>">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <img src="IFRC-Logo.png" alt="IFRC Logo" id="header-logo">
        <h1>HREF Indicators Analysis Tool</h1>
        <button id="info-icon" title="Information">‚Ñπ</button>
    </header>

    <!-- Main Content Area -->
    <main>
        <!-- Country Profile Section -->
        <div id="country-profile-section">
            <h3>Country Profile</h3>
            <div class="control-section">
                <label for="country-profile-select">Select Country:</label>
                <select id="country-profile-select">
                    <option value="">Select a country...</option>
                </select>
            </div>
            <div class="control-section">
                <button id="view-profile-btn" disabled>View Profile</button>
            </div>
        </div>

        <!-- Indicator Analysis Panel -->
        <div id="indicator-panel">
            <h3>Indicator Analysis</h3>
            <div class="control-section">
                <label for="category-select">Category:</label>
                <select id="category-select">
                    <option value="">Select a category...</option>
                </select>
            </div>
            <div class="control-section">
                <label for="indicator-select">Indicator:</label>
                <select id="indicator-select" disabled>
                    <option value="">Select an indicator...</option>
                </select>
            </div>
            <div class="control-section" id="year-section">
                <label for="year-select">Year:</label>
                <select id="year-select" disabled>
                    <option value="">Select a year...</option>
                </select>
            </div>
            <div class="control-section">
                <button id="load-data-btn" disabled>Load Data</button>
            </div>
            <div class="control-section">
                <button id="show-trend-btn" disabled style="background-color: #2196F3;">Show Time Trend</button>
            </div>
            <div class="control-section">
                <button id="clear-map-btn" style="background-color: #666;">Clear Map</button>
            </div>
        </div>

        <!-- Country Profile Panel -->
        <div id="country-profile-panel" class="hidden">
            <div id="country-profile-header">
                <h3 id="country-profile-title">Country Profile</h3>
                <button id="close-profile-btn">√ó</button>
            </div>
            <div id="country-profile-content">
                <p>Loading...</p>
            </div>
        </div>

        <!-- Time Series Chart Panel -->
        <div id="chart-panel" class="hidden">
            <div id="chart-header">
                <h3 id="chart-title">Time Series</h3>
                <div id="chart-controls">
                    <label for="country-filter">Filter by country:</label>
                    <select id="country-filter" multiple size="5">
                        <option value="all" selected>All Countries</option>
                    </select>
                    <div id="filter-buttons">
                        <button id="select-all-btn">Select All</button>
                        <button id="deselect-all-btn">Clear</button>
                    </div>
                    <div id="disaster-events-toggle" style="margin-top: 10px; display: none;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="show-disasters-checkbox" style="margin-right: 8px;">
                            <span>Show Disaster Events</span>
                        </label>
                    </div>
                </div>
                <button id="close-chart-btn">√ó</button>
            </div>
            <div id="chart-content">
                <canvas id="time-series-chart"></canvas>
            </div>
            <!-- Disaster Event Tooltip -->
            <div id="disaster-marker-tooltip" class="disaster-tooltip hidden"></div>
        </div>

        <!-- Map Container -->
        <div id="map"></div>

        <!-- Data List Panel -->
        <div id="data-list-panel" class="hidden">
            <div id="data-list-header">
                <h3 id="data-list-title">Data List</h3>
                <button id="close-data-list-btn">√ó</button>
            </div>
            <div id="data-list-content">
                <p>Loading...</p>
            </div>
        </div>

        <!-- Legend -->
        <div id="legend" class="hidden">
            <h4 id="legend-title">Legend</h4>
            <div id="legend-content"></div>
        </div>

        <!-- Timeline Bar -->
        <div id="timeline-container" class="hidden">
            <div id="timeline-header">
                <h4 id="timeline-title">Event Timeline</h4>
                <button id="close-timeline-btn">√ó</button>
            </div>
            <div id="timeline-content">
                <svg id="timeline-svg"></svg>
            </div>
            <div id="timeline-legend">
                <span class="timeline-legend-item"><span class="timeline-triangle"></span> Disaster Events</span>
                <span class="timeline-legend-item"><span class="timeline-dot" style="background: #dc2626;"></span> DREF Operations</span>
            </div>
        </div>

        <!-- Loading Popup -->
        <div id="loading-popup" class="hidden">
            <div id="loading-content">
                <div class="loading-spinner"></div>
                <p id="loading-message">Loading data...</p>
            </div>
        </div>

        <!-- Timeline Tooltip -->
        <div id="timeline-tooltip" class="timeline-tooltip hidden"></div>

        <!-- Welcome Modal -->
        <div id="welcome-modal" class="modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <h2>Welcome to the HREF Indicator Analysis tool</h2>
                <div class="modal-body">
                    <p>This tool brings together data from WHO, IHME, GDACS, EM-DAT and IFRC for the 25 countries in focus of the H3R initiative (IFRC - HHI).</p>

                    <p>To view all indicators for a specific country, select a country in the dropdown menu in the "Country Profile" box on the left handside, and click on "View Profile". This will highlight the country in question and display the most recent data for all available indicators for that country.</p>

                    <p>Please note that not all countries have the same level of availability of data, so you might not see the same year for some indicators depending on the country.</p>

                    <p>Clicking on "View Profile" will also display a time bar, showing the occurrence of disasters since 2018 (orange triangles) and the data of activation of DREF Operations (red circles). You can click on these icons to get more information as to the event they refer to.</p>

                    <p>Within the "Indicator Analysis" box, you can choose numerous indicators based on their category.</p>

                    <p>First select a Category, then an Indicator. You then have 2 options:</p>
                    <ul>
                        <li>you can choose a specific year, which will display the respective values for this indicator for each of the countries in scope</li>
                        <li>you can ignore the year and click on "Show Time Trend". This will open a new window with a graph, showing the evolution of the selected indicator values along the years (from 2018 to the year of most recently available data)</li>
                    </ul>

                    <p>Within the Time Trend window, you can select one or more countries (by pressing Ctrl and clicking on the countries of interest).</p>

                    <p>When you select only one country, you can display disaster events for that country by clicking on the "Show disaster events" box on the right of the country selection menu. This will display disaster events overlaid with the curve for the selected indicator.</p>

                    <p>To clear your selection, click on "Clear Map", at the bottom of the "Indicator Analysis" box.</p>

                    <p>For any questions on this tool, the data here displayed, its sources or any other topic, please contact Adri√°n Calvo-Valderrama (adrian.calvo@ifrc.org)</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 HREF Indicators Analysis Tool</p>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- Custom JS -->
    <script src="js/app.js?v=20251113n"></script>
</body>
</html>
